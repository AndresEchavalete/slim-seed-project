# Slim Seed Project - API Collection
# Compatible con Bruno, Insomnia, VS Code REST Client y otros clientes HTTP

# ===========================================
# CONFIGURACIÃ“N BASE
# ===========================================
@baseUrl = http://localhost:8081
@contentType = application/json

# ===========================================
# VARIABLES DE PRUEBA
# ===========================================
@testEmail = test@example.com
@testName = Test User
@testPassword = password123
@userId = 1

# ===========================================
# ENDPOINTS PÃšBLICOS
# ===========================================

### ğŸ  Bienvenida
GET {{baseUrl}}/
Accept: {{contentType}}

### ğŸ’š Health Check
GET {{baseUrl}}/health
Accept: {{contentType}}

### ğŸ“Š Status API
GET {{baseUrl}}/api/status
Accept: {{contentType}}

# ===========================================
# GESTIÃ“N DE USUARIOS
# ===========================================

### ğŸ‘¤ Crear Usuario
POST {{baseUrl}}/api/users
Content-Type: {{contentType}}

{
  "email": "{{testEmail}}",
  "name": "{{testName}}",
  "password": "{{testPassword}}"
}

### ğŸ‘¤ Crear Usuario Alternativo
POST {{baseUrl}}/api/users
Content-Type: {{contentType}}

{
  "email": "jane@example.com",
  "name": "Jane Doe",
  "password": "securepassword123"
}

### ğŸ‘¥ Obtener Usuarios Activos
GET {{baseUrl}}/api/users/active
Accept: {{contentType}}

### ğŸ” Obtener Usuario por ID
GET {{baseUrl}}/api/users/{{userId}}
Accept: {{contentType}}

### ğŸ” Obtener Usuario por ID (No existe)
GET {{baseUrl}}/api/users/999
Accept: {{contentType}}

### âœï¸ Actualizar Nombre de Usuario
PUT {{baseUrl}}/api/users/{{userId}}/name
Content-Type: {{contentType}}

{
  "name": "Usuario Actualizado"
}

### âœï¸ Actualizar Nombre de Usuario (No existe)
PUT {{baseUrl}}/api/users/999/name
Content-Type: {{contentType}}

{
  "name": "Usuario Inexistente"
}

### ğŸ” Autenticar Usuario
POST {{baseUrl}}/api/users/authenticate
Content-Type: {{contentType}}

{
  "email": "{{testEmail}}",
  "password": "{{testPassword}}"
}

### ğŸ” Autenticar Usuario (Credenciales Incorrectas)
POST {{baseUrl}}/api/users/authenticate
Content-Type: {{contentType}}

{
  "email": "{{testEmail}}",
  "password": "wrongpassword"
}

### ğŸ” Autenticar Usuario (No existe)
POST {{baseUrl}}/api/users/authenticate
Content-Type: {{contentType}}

{
  "email": "nonexistent@example.com",
  "password": "{{testPassword}}"
}

# ===========================================
# HISTORIAL DE SALUD
# ===========================================

### ğŸ“Š Ãšltimo Estado de Salud
GET {{baseUrl}}/api/health/latest
Accept: {{contentType}}

### ğŸ“ˆ Historial de Salud (Ãšltima Semana)
GET {{baseUrl}}/api/health/history?from=2025-09-19&to=2025-09-26
Accept: {{contentType}}

### ğŸ“ˆ Historial de Salud (Ãšltimo Mes)
GET {{baseUrl}}/api/health/history?from=2025-08-26&to=2025-09-26
Accept: {{contentType}}

### ğŸ“ˆ Historial de Salud (Sin ParÃ¡metros)
GET {{baseUrl}}/api/health/history
Accept: {{contentType}}

### ğŸ“ˆ Historial de Salud (Formato de Fecha InvÃ¡lido)
GET {{baseUrl}}/api/health/history?from=invalid-date&to=2025-09-26
Accept: {{contentType}}

# ===========================================
# NOTIFICACIONES
# ===========================================

### ğŸ”” Enviar Alerta Simple
POST {{baseUrl}}/api/notifications/alert
Content-Type: {{contentType}}

{
  "message": "Sistema en mantenimiento programado"
}

### ğŸ”” Enviar Alerta con Contexto
POST {{baseUrl}}/api/notifications/alert
Content-Type: {{contentType}}

{
  "message": "Mantenimiento programado del servidor",
  "context": {
    "duration": "2 hours",
    "affected_services": ["API", "Database", "Redis"],
    "severity": "high",
    "scheduled_time": "2025-09-26 15:00:00"
  }
}

### ğŸ”” Enviar Alerta de Error
POST {{baseUrl}}/api/notifications/alert
Content-Type: {{contentType}}

{
  "message": "Error crÃ­tico en el sistema de pagos",
  "context": {
    "error_code": "PAYMENT_001",
    "affected_users": 150,
    "priority": "critical",
    "timestamp": "2025-09-26 14:30:15"
  }
}

### ğŸ”” Enviar Alerta (Sin Mensaje)
POST {{baseUrl}}/api/notifications/alert
Content-Type: {{contentType}}

{
  "context": {
    "duration": "1 hour"
  }
}

### ğŸ§ª NotificaciÃ³n de Prueba
POST {{baseUrl}}/api/notifications/test
Content-Type: {{contentType}}

### ğŸ§ª NotificaciÃ³n de Prueba con Datos
POST {{baseUrl}}/api/notifications/test
Content-Type: {{contentType}}

{
  "subject": "Test Notification",
  "message": "This is a test notification from Slim Seed Project"
}

# ===========================================
# CASOS DE PRUEBA DE VALIDACIÃ“N
# ===========================================

### âŒ Crear Usuario (Email InvÃ¡lido)
POST {{baseUrl}}/api/users
Content-Type: {{contentType}}

{
  "email": "invalid-email",
  "name": "Test User",
  "password": "password123"
}

### âŒ Crear Usuario (Nombre VacÃ­o)
POST {{baseUrl}}/api/users
Content-Type: {{contentType}}

{
  "email": "test2@example.com",
  "name": "",
  "password": "password123"
}

### âŒ Crear Usuario (ContraseÃ±a Corta)
POST {{baseUrl}}/api/users
Content-Type: {{contentType}}

{
  "email": "test3@example.com",
  "name": "Test User",
  "password": "123"
}

### âŒ Crear Usuario (Email Duplicado)
POST {{baseUrl}}/api/users
Content-Type: {{contentType}}

{
  "email": "{{testEmail}}",
  "name": "Another User",
  "password": "password123"
}

### âŒ Crear Usuario (Sin Datos)
POST {{baseUrl}}/api/users
Content-Type: {{contentType}}

{}

### âŒ Crear Usuario (Datos Incompletos)
POST {{baseUrl}}/api/users
Content-Type: {{contentType}}

{
  "email": "incomplete@example.com"
}

# ===========================================
# CASOS DE PRUEBA DE RENDIMIENTO
# ===========================================

### ğŸš€ Health Check (MÃºltiples Requests)
GET {{baseUrl}}/health
Accept: {{contentType}}

### ğŸš€ Health Check (MÃºltiples Requests)
GET {{baseUrl}}/health
Accept: {{contentType}}

### ğŸš€ Health Check (MÃºltiples Requests)
GET {{baseUrl}}/health
Accept: {{contentType}}

### ğŸš€ Health Check (MÃºltiples Requests)
GET {{baseUrl}}/health
Accept: {{contentType}}

### ğŸš€ Health Check (MÃºltiples Requests)
GET {{baseUrl}}/health
Accept: {{contentType}}

# ===========================================
# CASOS DE PRUEBA DE ESTRÃ‰S
# ===========================================

### ğŸ”¥ Crear MÃºltiples Usuarios
POST {{baseUrl}}/api/users
Content-Type: {{contentType}}

{
  "email": "user1@example.com",
  "name": "User 1",
  "password": "password123"
}

### ğŸ”¥ Crear MÃºltiples Usuarios
POST {{baseUrl}}/api/users
Content-Type: {{contentType}}

{
  "email": "user2@example.com",
  "name": "User 2",
  "password": "password123"
}

### ğŸ”¥ Crear MÃºltiples Usuarios
POST {{baseUrl}}/api/users
Content-Type: {{contentType}}

{
  "email": "user3@example.com",
  "name": "User 3",
  "password": "password123"
}

### ğŸ”¥ Crear MÃºltiples Usuarios
POST {{baseUrl}}/api/users
Content-Type: {{contentType}}

{
  "email": "user4@example.com",
  "name": "User 4",
  "password": "password123"
}

### ğŸ”¥ Crear MÃºltiples Usuarios
POST {{baseUrl}}/api/users
Content-Type: {{contentType}}

{
  "email": "user5@example.com",
  "name": "User 5",
  "password": "password123"
}

# ===========================================
# CASOS DE PRUEBA DE CONCURRENCIA
# ===========================================

### âš¡ Actualizar Usuario (Concurrente 1)
PUT {{baseUrl}}/api/users/{{userId}}/name
Content-Type: {{contentType}}

{
  "name": "Concurrent Update 1"
}

### âš¡ Actualizar Usuario (Concurrente 2)
PUT {{baseUrl}}/api/users/{{userId}}/name
Content-Type: {{contentType}}

{
  "name": "Concurrent Update 2"
}

### âš¡ Actualizar Usuario (Concurrente 3)
PUT {{baseUrl}}/api/users/{{userId}}/name
Content-Type: {{contentType}}

{
  "name": "Concurrent Update 3"
}

# ===========================================
# CASOS DE PRUEBA DE SEGURIDAD
# ===========================================

### ğŸ”’ SQL Injection Test
GET {{baseUrl}}/api/users/1'; DROP TABLE users; --
Accept: {{contentType}}

### ğŸ”’ XSS Test
POST {{baseUrl}}/api/users
Content-Type: {{contentType}}

{
  "email": "test@example.com",
  "name": "<script>alert('XSS')</script>",
  "password": "password123"
}

### ğŸ”’ Path Traversal Test
GET {{baseUrl}}/api/users/../../../etc/passwd
Accept: {{contentType}}

### ğŸ”’ Large Payload Test
POST {{baseUrl}}/api/users
Content-Type: {{contentType}}

{
  "email": "test@example.com",
  "name": "A".repeat(10000),
  "password": "password123"
}

# ===========================================
# CASOS DE PRUEBA DE HEADERS
# ===========================================

### ğŸ“‹ Request con Headers Personalizados
GET {{baseUrl}}/health
Accept: {{contentType}}
X-Custom-Header: Test-Value
X-Request-ID: 12345
User-Agent: Slim-Seed-Test-Client/1.0

### ğŸ“‹ Request con Content-Type Incorrecto
POST {{baseUrl}}/api/users
Content-Type: text/plain

email=test@example.com&name=Test User&password=password123

### ğŸ“‹ Request sin Content-Type
POST {{baseUrl}}/api/users

{
  "email": "test@example.com",
  "name": "Test User",
  "password": "password123"
}

# ===========================================
# CASOS DE PRUEBA DE MÃ‰TODOS HTTP
# ===========================================

### ğŸš« MÃ©todo No Permitido (DELETE en Health)
DELETE {{baseUrl}}/health
Accept: {{contentType}}

### ğŸš« MÃ©todo No Permitido (PATCH en Users)
PATCH {{baseUrl}}/api/users/1
Content-Type: {{contentType}}

{
  "name": "Updated Name"
}

### ğŸš« MÃ©todo No Permitido (OPTIONS)
OPTIONS {{baseUrl}}/api/users
Accept: {{contentType}}

# ===========================================
# CASOS DE PRUEBA DE CÃ“DIGOS DE ESTADO
# ===========================================

### âœ… 200 OK
GET {{baseUrl}}/health
Accept: {{contentType}}

### âœ… 201 Created
POST {{baseUrl}}/api/users
Content-Type: {{contentType}}

{
  "email": "newuser@example.com",
  "name": "New User",
  "password": "password123"
}

### âŒ 400 Bad Request
POST {{baseUrl}}/api/users
Content-Type: {{contentType}}

{
  "email": "invalid-email",
  "name": "Test User",
  "password": "password123"
}

### âŒ 401 Unauthorized
POST {{baseUrl}}/api/users/authenticate
Content-Type: {{contentType}}

{
  "email": "test@example.com",
  "password": "wrongpassword"
}

### âŒ 404 Not Found
GET {{baseUrl}}/api/users/999
Accept: {{contentType}}

### âŒ 405 Method Not Allowed
DELETE {{baseUrl}}/health
Accept: {{contentType}}

### âŒ 500 Internal Server Error
# Este caso se puede simular con un endpoint que genere error interno
GET {{baseUrl}}/api/error
Accept: {{contentType}}

# ===========================================
# NOTAS DE USO
# ===========================================

# 1. AsegÃºrate de que el servidor estÃ© ejecutÃ¡ndose en http://localhost:8081
# 2. Ejecuta las migraciones antes de probar los endpoints de usuarios
# 3. Algunos tests requieren que existan usuarios en la base de datos
# 4. Los tests de concurrencia pueden mostrar comportamientos interesantes
# 5. Los tests de seguridad estÃ¡n diseÃ±ados para verificar que la API sea robusta
# 6. Usa las variables @testEmail, @testName, @testPassword para personalizar las pruebas
# 7. El @userId se actualiza automÃ¡ticamente cuando creas un usuario
# 8. Algunos endpoints pueden requerir autenticaciÃ³n en futuras versiones

# ===========================================
# COMANDOS ÃšTILES
# ===========================================

# Verificar que el servidor estÃ© funcionando:
# curl http://localhost:8081/health

# Ejecutar migraciones:
# docker-compose exec -T app bash -c "cd /var/www/html && php scripts/migrate.php"

# Ver logs del servidor:
# docker-compose logs -f app

# Reiniciar el servidor:
# docker-compose restart app
